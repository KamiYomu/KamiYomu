<div id="loading-indicator" class="d-none position-fixed top-0 start-0 w-100 h-100 bg-light-subtle bg-opacity-25 z-3 flex-column justify-content-center align-items-center">
    <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">@I18n.ProcessingCertainCrawlerAgentaRequireMoreTime</span>
    </div>
    <button id="cancel-request-btn" class="btn btn-outline-danger btn-sm">
        @I18n.Close
    </button>
</div>

<script>
    const loading = document.getElementById('loading-indicator');
    const cancelBtn = document.getElementById('cancel-request-btn');
    let currentRequest = null;

    function showLoading() {
      loading.classList.remove('d-none');
      loading.classList.add('d-flex');
    }

    function hideLoading() {
      loading.classList.remove('d-flex');
      loading.classList.add('d-none');
    }

    function cleanupRequest() {
      currentRequest = null;
      hideLoading();
    }

    document.body.addEventListener('htmx:beforeRequest', evt => {
      currentRequest = evt.detail.xhr;
      showLoading();
    });

    document.body.addEventListener('htmx:afterRequest', cleanupRequest);
    document.body.addEventListener('htmx:responseError', cleanupRequest);
    document.body.addEventListener('htmx:sendError', cleanupRequest);
    document.body.addEventListener('htmx:timeout', cleanupRequest);
    document.body.addEventListener('htmx:abort', cleanupRequest);

    cancelBtn.addEventListener('click', () => {
      if (currentRequest) {
        currentRequest.abort();
        cleanupRequest();
      }
    });
</script>
